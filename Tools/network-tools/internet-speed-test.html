<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Internet Speed Test - Online Tools</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/js/all.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: #ffffff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            width: 100%;
            max-width: 800px;
        }

        .header h1 {
            font-size: 2.8em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .header p {
            font-size: 1.15em;
            color: #5a6c7d;
            font-weight: 400;
        }

        .container {
            background: #ffffff;
            border-radius: 30px;
            padding: 50px;
            box-shadow: 0 10px 60px rgba(102, 126, 234, 0.15);
            max-width: 800px;
            width: 100%;
            border: 1px solid #f0f3ff;
        }

        .speedometer-section {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .speed-display {
            width: 300px;
            height: 300px;
            margin: 0 auto 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.25);
            position: relative;
            overflow: hidden;
        }

        .speed-display::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            bottom: 15px;
            background: white;
            border-radius: 50%;
            box-shadow: inset 0 5px 20px rgba(0,0,0,0.05);
        }

        .speed-content {
            position: relative;
            z-index: 2;
        }

        .speed-value {
            font-size: 4.5em;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
            margin-bottom: 5px;
        }

        .speed-unit {
            font-size: 1.4em;
            color: #667eea;
            font-weight: 600;
        }

        .speed-label {
            position: absolute;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.95em;
            color: #5a6c7d;
            font-weight: 500;
        }

        .status-badge {
            display: inline-block;
            padding: 12px 30px;
            background: linear-gradient(135deg, #f0f3ff 0%, #e8ecff 100%);
            border-radius: 50px;
            font-weight: 600;
            color: #667eea;
            font-size: 1em;
            margin-bottom: 25px;
            border: 2px solid #e0e6ff;
        }

        .test-button {
            width: 100%;
            max-width: 400px;
            padding: 20px;
            font-size: 1.3em;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.4s ease;
            margin: 0 auto 40px;
            display: block;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            letter-spacing: 0.5px;
        }

        .test-button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.5);
        }

        .test-button:active:not(:disabled) {
            transform: translateY(-1px);
        }

        .test-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .results-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .result-box {
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f3ff 100%);
            padding: 30px 20px;
            border-radius: 20px;
            text-align: center;
            border: 2px solid #e8ecff;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .result-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }

        .result-box:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }

        .result-box:hover::before {
            transform: scaleX(1);
        }

        .result-icon {
            font-size: 2.8em;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .result-label {
            font-size: 0.95em;
            color: #5a6c7d;
            margin-bottom: 10px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .result-value {
            font-size: 2.2em;
            font-weight: 800;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .result-unit {
            font-size: 0.9em;
            color: #667eea;
            font-weight: 600;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .info-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
            padding: 25px;
            border-radius: 20px;
            border: 2px solid #f0f3ff;
            transition: all 0.3s ease;
        }

        .info-card:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.15);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .info-icon {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3em;
        }

        .info-title {
            font-size: 0.9em;
            color: #5a6c7d;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-content {
            font-size: 1.2em;
            color: #2c3e50;
            font-weight: 700;
            padding-left: 57px;
        }

        .progress-container {
            width: 100%;
            height: 6px;
            background: #f0f3ff;
            border-radius: 10px;
            overflow: hidden;
            margin: 25px 0;
            display: none;
        }

        .progress-container.active {
            display: block;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 12px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .back-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.5);
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .loading {
            animation: rotate 1s linear infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .testing {
            animation: pulse 2s ease-in-out infinite;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }

            .container {
                padding: 30px 20px;
            }

            .speed-display {
                width: 250px;
                height: 250px;
            }

            .speed-value {
                font-size: 3.5em;
            }

            .results-container {
                grid-template-columns: 1fr;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .test-button {
                font-size: 1.1em;
                padding: 18px;
            }
        }
    </style>
</head>
<body>

<a href="../tools.html" class="back-button">
    <i class="fas fa-arrow-left"></i> Back to Tools
</a>

<div class="header">
    <h1><i class="fas fa-tachometer-alt"></i> Internet Speed Test</h1>
    <p>Test your internet connection speed in real-time</p>
</div>

<div class="container">
    <div class="speedometer-section">
        <div class="speed-display" id="speedDisplay">
            <div class="speed-content">
                <div class="speed-value" id="speedValue">0</div>
                <div class="speed-unit">Mbps</div>
            </div>
            <div class="speed-label" id="speedLabel">Ready to test</div>
        </div>
        <div class="status-badge" id="statusBadge">
            <i class="fas fa-circle" style="font-size: 0.6em; margin-right: 8px;"></i>
            Click "Start Test" to begin
        </div>
    </div>

    <div class="progress-container" id="progressContainer">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <button class="test-button" id="startBtn" onclick="startSpeedTest()">
        <i class="fas fa-play-circle"></i> Start Speed Test
    </button>

    <div class="results-container">
        <div class="result-box">
            <div class="result-icon"><i class="fas fa-download"></i></div>
            <div class="result-label">Download</div>
            <div class="result-value" id="downloadSpeed">--</div>
            <div class="result-unit">Mbps</div>
        </div>
        <div class="result-box">
            <div class="result-icon"><i class="fas fa-upload"></i></div>
            <div class="result-label">Upload</div>
            <div class="result-value" id="uploadSpeed">--</div>
            <div class="result-unit">Mbps</div>
        </div>
        <div class="result-box">
            <div class="result-icon"><i class="fas fa-wifi"></i></div>
            <div class="result-label">Ping</div>
            <div class="result-value" id="pingValue">--</div>
            <div class="result-unit">ms</div>
        </div>
    </div>

    <div class="info-grid">
        <div class="info-card">
            <div class="info-header">
                <div class="info-icon"><i class="fas fa-globe"></i></div>
                <div class="info-title">IP Address</div>
            </div>
            <div class="info-content" id="ipAddress">Loading...</div>
        </div>
        <div class="info-card">
            <div class="info-header">
                <div class="info-icon"><i class="fas fa-map-marker-alt"></i></div>
                <div class="info-title">Location</div>
            </div>
            <div class="info-content" id="location">Loading...</div>
        </div>
        <div class="info-card">
            <div class="info-header">
                <div class="info-icon"><i class="fas fa-building"></i></div>
                <div class="info-title">ISP Provider</div>
            </div>
            <div class="info-content" id="isp">Loading...</div>
        </div>
        <div class="info-card">
            <div class="info-header">
                <div class="info-icon"><i class="fas fa-signal"></i></div>
                <div class="info-title">Connection</div>
            </div>
            <div class="info-content" id="connectionType">Detecting...</div>
        </div>
    </div>
</div>

<script>
let testRunning = false;
let downloadController = null;
let uploadController = null;

// Get Real IP and Location Info using ipapi.co
async function getIPInfo() {
    try {
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        
        document.getElementById('ipAddress').textContent = data.ip || 'Unknown';
        document.getElementById('location').textContent = `${data.city || ''}, ${data.country_name || 'Unknown'}`.trim().replace(/^,\s*/, '');
        document.getElementById('isp').textContent = data.org || 'Unknown';
    } catch (error) {
        console.error('IP Info Error:', error);
        document.getElementById('ipAddress').textContent = 'Unable to detect';
        document.getElementById('location').textContent = 'Unable to detect';
        document.getElementById('isp').textContent = 'Unable to detect';
    }
}

// Detect Connection Type
function detectConnectionType() {
    const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
    if (connection) {
        const type = connection.effectiveType || 'unknown';
        const typeMap = {
            'slow-2g': '2G (Slow)',
            '2g': '2G',
            '3g': '3G',
            '4g': '4G/LTE',
            '5g': '5G'
        };
        document.getElementById('connectionType').textContent = typeMap[type] || type.toUpperCase();
    } else {
        document.getElementById('connectionType').textContent = 'WiFi/Ethernet';
    }
}

// Real-time Ping Test
async function measurePing() {
    const measurements = [];
    for (let i = 0; i < 5; i++) {
        const startTime = performance.now();
        try {
            await fetch('https://www.cloudflare.com/cdn-cgi/trace', { 
                method: 'GET',
                cache: 'no-store'
            });
            const endTime = performance.now();
            measurements.push(Math.round(endTime - startTime));
        } catch {
            measurements.push(0);
        }
    }
    const validMeasurements = measurements.filter(m => m > 0);
    return validMeasurements.length > 0 
        ? Math.round(validMeasurements.reduce((a, b) => a + b) / validMeasurements.length)
        : 0;
}

// Real-time Download Speed using Cloudflare
async function measureDownloadSpeed() {
    return new Promise(async (resolve) => {
        const sizes = [5000000, 10000000, 25000000]; // 5MB, 10MB, 25MB
        let bestSpeed = 0;
        
        for (const size of sizes) {
            downloadController = new AbortController();
            const url = `https://speed.cloudflare.com/__down?bytes=${size}`;
            const startTime = performance.now();
            
            try {
                const response = await fetch(url, {
                    cache: 'no-store',
                    signal: downloadController.signal
                });
                
                const reader = response.body.getReader();
                let receivedLength = 0;
                let lastUpdate = startTime;
                
                while (true) {
                    const {done, value} = await reader.read();
                    
                    if (done) break;
                    
                    receivedLength += value.length;
                    const currentTime = performance.now();
                    
                    // Update speed in real-time
                    if (currentTime - lastUpdate > 100) { // Update every 100ms
                        const duration = (currentTime - startTime) / 1000;
                        const bitsLoaded = receivedLength * 8;
                        const currentSpeed = (bitsLoaded / duration / 1024 / 1024);
                        
                        document.getElementById('speedValue').textContent = currentSpeed.toFixed(2);
                        document.getElementById('speedLabel').textContent = 'Downloading...';
                        
                        bestSpeed = Math.max(bestSpeed, currentSpeed);
                        lastUpdate = currentTime;
                    }
                }
                
                const endTime = performance.now();
                const duration = (endTime - startTime) / 1000;
                const bitsLoaded = receivedLength * 8;
                const finalSpeed = (bitsLoaded / duration / 1024 / 1024);
                
                bestSpeed = Math.max(bestSpeed, finalSpeed);
                
            } catch (error) {
                if (error.name !== 'AbortError') {
                    console.error('Download test error:', error);
                }
            }
        }
        
        resolve(bestSpeed);
    });
}

// Real-time Upload Speed using Cloudflare
async function measureUploadSpeed() {
    return new Promise(async (resolve) => {
        const sizes = [1000000, 5000000, 10000000]; // 1MB, 5MB, 10MB
        let bestSpeed = 0;
        
        for (const size of sizes) {
            uploadController = new AbortController();
            const data = new Uint8Array(size);
            crypto.getRandomValues(data);
            
            const startTime = performance.now();
            
            try {
                const xhr = new XMLHttpRequest();
                xhr.open('POST', 'https://speed.cloudflare.com/__up', true);
                
                let lastLoaded = 0;
                let lastUpdate = startTime;
                
                xhr.upload.onprogress = (e) => {
                    if (e.lengthComputable) {
                        const currentTime = performance.now();
                        
                        if (currentTime - lastUpdate > 100) {
                            const duration = (currentTime - startTime) / 1000;
                            const bitsUploaded = e.loaded * 8;
                            const currentSpeed = (bitsUploaded / duration / 1024 / 1024);
                            
                            document.getElementById('speedValue').textContent = currentSpeed.toFixed(2);
                            document.getElementById('speedLabel').textContent = 'Uploading...';
                            
                            bestSpeed = Math.max(bestSpeed, currentSpeed);
                            lastUpdate = currentTime;
                            lastLoaded = e.loaded;
                        }
                    }
                };
                
                xhr.onload = () => {
                    const endTime = performance.now();
                    const duration = (endTime - startTime) / 1000;
                    const bitsUploaded = size * 8;
                    const finalSpeed = (bitsUploaded / duration / 1024 / 1024);
                    
                    bestSpeed = Math.max(bestSpeed, finalSpeed);
                    resolve(bestSpeed);
                };
                
                xhr.onerror = () => resolve(bestSpeed);
                
                xhr.send(data);
                
            } catch (error) {
                console.error('Upload test error:', error);
            }
        }
    });
}

// Update Progress
function updateProgress(percent) {
    document.getElementById('progressBar').style.width = percent + '%';
}

// Update Status
function updateStatus(text, icon = 'circle') {
    const badge = document.getElementById('statusBadge');
    badge.innerHTML = `<i class="fas fa-${icon}" style="font-size: 0.6em; margin-right: 8px;"></i>${text}`;
}

// Start Speed Test
async function startSpeedTest() {
    if (testRunning) return;
    
    testRunning = true;
    const startBtn = document.getElementById('startBtn');
    const speedDisplay = document.getElementById('speedDisplay');
    const progressContainer = document.getElementById('progressContainer');
    
    startBtn.disabled = true;
    startBtn.innerHTML = '<i class="fas fa-spinner loading"></i> Testing...';
    speedDisplay.classList.add('testing');
    progressContainer.classList.add('active');
    
    // Reset
    document.getElementById('speedValue').textContent = '0';
    document.getElementById('downloadSpeed').textContent = '--';
    document.getElementById('uploadSpeed').textContent = '--';
    document.getElementById('pingValue').textContent = '--';
    updateProgress(0);
    
    try {
        // Step 1: Ping Test
        updateStatus('Measuring latency...', 'signal');
        document.getElementById('speedLabel').textContent = 'Testing ping...';
        updateProgress(10);
        
        const ping = await measurePing();
        document.getElementById('pingValue').textContent = ping;
        updateProgress(25);
        
        await new Promise(resolve => setTimeout(resolve, 500));
        
        // Step 2: Download Test
        updateStatus('Testing download speed...', 'download');
        updateProgress(30);
        
        const downloadSpeed = await measureDownloadSpeed();
        document.getElementById('downloadSpeed').textContent = downloadSpeed.toFixed(2);
        document.getElementById('speedValue').textContent = downloadSpeed.toFixed(2);
        updateProgress(65);
        
        await new Promise(resolve => setTimeout(resolve, 800));
        
        // Step 3: Upload Test
        updateStatus('Testing upload speed...', 'upload');
        updateProgress(70);
        
        const uploadSpeed = await measureUploadSpeed();
        document.getElementById('uploadSpeed').textContent = uploadSpeed.toFixed(2);
        updateProgress(100);
        
        // Complete
        document.getElementById('speedLabel').textContent = 'Test Complete!';
        updateStatus('Test completed successfully!', 'check-circle');
        
    } catch (error) {
        console.error('Test error:', error);
        updateStatus('Test failed. Try again.', 'exclamation-circle');
    }
    
    startBtn.disabled = false;
    startBtn.innerHTML = '<i class="fas fa-redo-alt"></i> Test Again';
    speedDisplay.classList.remove('testing');
    testRunning = false;
    
    setTimeout(() => {
        progressContainer.classList.remove('active');
        updateProgress(0);
    }, 2000);
}

// Initialize
window.onload = function() {
    getIPInfo();
    detectConnectionType();
};
</script>

</body>
</html>