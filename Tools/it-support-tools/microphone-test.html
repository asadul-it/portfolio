<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microphone Test - Online Tools</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/js/all.min.js" crossorigin="anonymous"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #2c3e50;
        }

        .fixed-header-container {
            position: sticky;
            top: 0;
            width: 100%;
            background: #ffffff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px 20px;
        }

        .navbar {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .navbar ul {
            list-style: none;
            display: flex;
            gap: 30px;
            margin: 0;
            padding: 0;
            align-items: center;
        }

        .navbar ul li a {
            color: #2c3e50;
            text-decoration: none;
            font-weight: 600;
            padding: 8px 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1em;
        }

        .navbar ul li a:hover {
            color: #2563eb;
        }

        .navbar ul li a i {
            font-size: 1.2em;
        }

        .hamburger {
            display: none;
            flex-direction: column;
            cursor: pointer;
            gap: 5px;
            padding: 10px;
        }

        .hamburger span {
            width: 28px;
            height: 3px;
            background: #2563eb;
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
            width: 100%;
            flex: 1;
        }

        .breadcrumb {
            margin-bottom: 20px;
            color: #5a6c7d;
        }

        .breadcrumb a {
            color: #2563eb;
            text-decoration: none;
            font-weight: 600;
        }

        .tool-container {
            background: #ffffff;
            border-radius: 10px;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }

        .tool-title {
            font-size: 2em;
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .tool-title i {
            color: #2563eb;
            font-size: 2em;
        }

        .tool-description {
            color: #5a6c7d;
            margin-bottom: 30px;
            font-size: 1.05em;
            line-height: 1.6;
        }

        .instruction-box {
            background: #dbeafe;
            border-left: 4px solid #2563eb;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .instruction-box h3 {
            color: #1e40af;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .instruction-box p {
            color: #1e3a8a;
            line-height: 1.6;
        }

        .mic-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #cbd5e1;
            border-radius: 8px;
            font-size: 1em;
            font-family: 'Montserrat', sans-serif;
            margin-bottom: 20px;
            background: white;
        }

        .visualizer-container {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            min-height: 400px;
        }

        .mic-icon-container {
            text-align: center;
            margin-bottom: 30px;
        }

        .mic-icon {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            color: white;
            position: relative;
            transition: all 0.3s ease;
        }

        .mic-icon.active {
            animation: micPulse 2s infinite;
            box-shadow: 0 0 30px rgba(37, 99, 235, 0.6);
        }

        @keyframes micPulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }

        .volume-meter {
            width: 100%;
            max-width: 600px;
            height: 60px;
            background: #334155;
            border-radius: 30px;
            margin: 0 auto 30px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);
        }

        .volume-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #10b981 0%, #f59e0b 50%, #ef4444 100%);
            border-radius: 30px;
            transition: width 0.1s ease;
            position: relative;
        }

        .volume-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 20px;
            height: 100%;
            background: rgba(255,255,255,0.3);
            border-radius: 0 30px 30px 0;
        }

        .volume-label {
            text-align: center;
            color: #94a3b8;
            font-size: 1.1em;
            margin-top: 10px;
            font-weight: 600;
        }

        .volume-db {
            color: #22d3ee;
            font-size: 2em;
            font-weight: 700;
            font-family: 'Courier New', monospace;
        }

        .waveform-canvas {
            width: 100%;
            height: 150px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .frequency-canvas {
            width: 100%;
            height: 150px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 10px;
        }

        .control-panel {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 30px;
            justify-content: center;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-start {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-start:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        .btn-stop {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .btn-stop:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }

        .btn-record {
            background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
            color: white;
        }

        .btn-record:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(236, 72, 153, 0.4);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .mic-info {
            background: #1e293b;
            color: #f1f5f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #334155;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #94a3b8;
        }

        .info-value {
            color: #22d3ee;
            font-weight: 700;
        }

        .recording-list {
            margin-top: 30px;
        }

        .recording-item {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-left: 4px solid #2563eb;
        }

        .recording-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .recording-controls {
            display: flex;
            gap: 10px;
        }

        .btn-play {
            background: #10b981;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 0.9em;
        }

        .btn-download {
            background: #2563eb;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 0.9em;
        }

        .btn-delete {
            background: #ef4444;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 0.9em;
        }

        footer {
            background: #ffffff;
            padding: 40px 20px;
            margin-top: 30px;
            border-top: 2px solid #f0f3ff;
        }

        .footer-bottom {
            text-align: center;
            color: #5a6c7d;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .navbar ul {
                display: none;
            }

            .hamburger {
                display: flex;
            }

            .tool-container {
                padding: 20px;
            }

            .visualizer-container {
                padding: 20px;
            }

            .control-panel {
                flex-direction: column;
            }

            button {
                width: 100%;
                justify-content: center;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .recording-item {
                flex-direction: column;
                gap: 10px;
            }

            .recording-controls {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>

<div class="fixed-header-container">
    <div class="header-content">
        <nav class="navbar" id="navbar">
            <div class="nav-container">
                <ul id="navMenu">
                    <li><a href="../../index.html"><i class="fas fa-home"></i> Home</a></li>
                    <li><a href="../../skills.html"><i class="fas fa-cogs"></i> Skills</a></li>
                    <li><a href="../tools.html"><i class="fas fa-tools"></i> Tools</a></li>
                    <li><a href="../../certificate.html"><i class="fas fa-certificate"></i> Certificate</a></li>
                    <li><a href="../../contact.html"><i class="fas fa-phone"></i> Contact</a></li>
                </ul>
            </div>
        </nav>
        <div class="hamburger" id="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
</div>

<div class="container">
    <div class="breadcrumb">
        <a href="../../index.html">Home</a> / 
        <a href="../tools.html">Tools</a> / 
        <a href="../tools.html">IT Support</a> / 
        Microphone Test
    </div>

    <div class="tool-container">
        <h2 class="tool-title">
            <i class="fas fa-microphone"></i> Microphone Test
        </h2>
        <p class="tool-description">
            Test your microphone quality, volume levels, and audio clarity. Real-time waveform visualization, frequency analysis, and recording capabilities. Perfect for video calls, podcasting, and audio troubleshooting!
        </p>

        <div class="instruction-box">
            <h3><i class="fas fa-info-circle"></i> How to Use</h3>
            <p>Select your microphone and click "Start Test". Speak into your microphone to see real-time volume levels, waveforms, and frequency visualization. You can also record audio clips to test playback quality. All processing is done locally.</p>
        </div>

        <div>
            <select id="micSelect" class="mic-select">
                <option value="">Select Microphone Device</option>
            </select>
        </div>

        <div class="visualizer-container">
            <div class="mic-icon-container">
                <div class="mic-icon" id="micIcon">
                    <i class="fas fa-microphone"></i>
                </div>
            </div>

            <div class="volume-meter">
                <div class="volume-fill" id="volumeFill"></div>
            </div>
            <div class="volume-label">
                Volume: <span class="volume-db" id="volumeDb">0 dB</span>
            </div>

            <canvas id="waveformCanvas" class="waveform-canvas"></canvas>
            <canvas id="frequencyCanvas" class="frequency-canvas"></canvas>
        </div>

        <div class="control-panel">
            <button class="btn-start" id="startBtn" onclick="startTest()">
                <i class="fas fa-play"></i> Start Test
            </button>
            <button class="btn-stop" id="stopBtn" onclick="stopTest()" style="display: none;">
                <i class="fas fa-stop"></i> Stop Test
            </button>
            <button class="btn-record" id="recordBtn" onclick="toggleRecording()" disabled>
                <i class="fas fa-circle"></i> <span id="recordText">Start Recording</span>
            </button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="peakVolume">0</div>
                <div class="stat-label">Peak Volume (dB)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgVolume">0</div>
                <div class="stat-label">Average Volume (dB)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="duration">0:00</div>
                <div class="stat-label">Test Duration</div>
            </div>
        </div>

        <div class="mic-info" id="micInfo" style="display: none;">
            <div class="info-row">
                <span class="info-label">Microphone Name:</span>
                <span class="info-value" id="micName">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">Status:</span>
                <span class="info-value" id="micStatus">Inactive</span>
            </div>
            <div class="info-row">
                <span class="info-label">Sample Rate:</span>
                <span class="info-value" id="sampleRate">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">Latency:</span>
                <span class="info-value" id="latency">-</span>
            </div>
        </div>

        <div class="recording-list" id="recordingList" style="display: none;">
            <h3 style="margin-bottom: 15px; color: #2c3e50;">
                <i class="fas fa-list"></i> Recordings
            </h3>
            <div id="recordings"></div>
        </div>
    </div>
</div>

<footer>
    <div class="footer-bottom">
        <p>&copy; 2024 Online Tools. All rights reserved.</p>
    </div>
</footer>

<script>
    let audioContext;
    let analyser;
    let microphone;
    let dataArray;
    let bufferLength;
    let animationId;
    let mediaRecorder;
    let audioChunks = [];
    let isRecording = false;
    let startTime;
    let timerInterval;
    let peakVol = 0;
    let avgVol = 0;
    let volumeReadings = [];
    let recordingCount = 0;

    // Get available microphones
    async function getMicrophones() {
        try {
            const devices = await navigator.mediaDevices.enumerateDevices();
            const mics = devices.filter(device => device.kind === 'audioinput');
            const select = document.getElementById('micSelect');
            
            mics.forEach((mic, index) => {
                const option = document.createElement('option');
                option.value = mic.deviceId;
                option.text = mic.label || `Microphone ${index + 1}`;
                select.appendChild(option);
            });

            if (mics.length > 0) {
                select.value = mics[0].deviceId;
            }
        } catch (err) {
            console.error('Error getting microphones:', err);
        }
    }

    getMicrophones();

    async function startTest() {
        try {
            const select = document.getElementById('micSelect');
            const deviceId = select.value;

            const constraints = {
                audio: deviceId ? { deviceId: { exact: deviceId } } : true
            };

            const stream = await navigator.mediaDevices.getUserMedia(constraints);
            
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            microphone = audioContext.createMediaStreamSource(stream);
            
            analyser.fftSize = 2048;
            bufferLength = analyser.frequencyBinCount;
            dataArray = new Uint8Array(bufferLength);
            
            microphone.connect(analyser);

            // Setup MediaRecorder
            mediaRecorder = new MediaRecorder(stream);
            mediaRecorder.ondataavailable = (e) => {
                audioChunks.push(e.data);
            };

            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'flex';
            document.getElementById('recordBtn').disabled = false;
            document.getElementById('micIcon').classList.add('active');
            document.getElementById('micInfo').style.display = 'block';
            document.getElementById('micStatus').textContent = 'Active';

            // Update mic info
            const track = stream.getAudioTracks()[0];
            const settings = track.getSettings();
            document.getElementById('micName').textContent = track.label;
            document.getElementById('sampleRate').textContent = `${settings.sampleRate || audioContext.sampleRate} Hz`;
            document.getElementById('latency').textContent = `${(audioContext.baseLatency * 1000).toFixed(2)} ms`;

            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
            
            visualize();

        } catch (err) {
            alert('Error accessing microphone: ' + err.message);
            console.error('Error:', err);
        }
    }

    function stopTest() {
        if (animationId) {
            cancelAnimationFrame(animationId);
        }
        
        if (microphone) {
            microphone.disconnect();
        }
        
        if (audioContext) {
            audioContext.close();
        }

        if (timerInterval) {
            clearInterval(timerInterval);
        }

        document.getElementById('startBtn').style.display = 'flex';
        document.getElementById('stopBtn').style.display = 'none';
        document.getElementById('recordBtn').disabled = true;
        document.getElementById('micIcon').classList.remove('active');
        document.getElementById('micStatus').textContent = 'Inactive';
        document.getElementById('volumeFill').style.width = '0%';
        document.getElementById('volumeDb').textContent = '0 dB';

        // Reset stats
        peakVol = 0;
        avgVol = 0;
        volumeReadings = [];
    }

    function toggleRecording() {
        if (isRecording) {
            mediaRecorder.stop();
            isRecording = false;
            document.getElementById('recordText').textContent = 'Start Recording';
            document.getElementById('recordBtn').innerHTML = '<i class="fas fa-circle"></i> <span id="recordText">Start Recording</span>';
            
            mediaRecorder.onstop = () => {
                const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                const audioUrl = URL.createObjectURL(audioBlob);
                addRecording(audioUrl);
                audioChunks = [];
            };
        } else {
            audioChunks = [];
            mediaRecorder.start();
            isRecording = true;
            document.getElementById('recordText').textContent = 'Stop Recording';
            document.getElementById('recordBtn').innerHTML = '<i class="fas fa-stop"></i> <span id="recordText">Stop Recording</span>';
        }
    }

    function addRecording(url) {
        recordingCount++;
        const list = document.getElementById('recordingList');
        const recordings = document.getElementById('recordings');
        list.style.display = 'block';

        const item = document.createElement('div');
        item.className = 'recording-item';
        item.innerHTML = `
            <div class="recording-info">
                <i class="fas fa-file-audio" style="font-size: 1.5em; color: #2563eb;"></i>
                <span style="font-weight: 600;">Recording ${recordingCount}</span>
            </div>
            <div class="recording-controls">
                <button class="btn-play" onclick="playRecording('${url}')">
                    <i class="fas fa-play"></i> Play
                </button>
                <button class="btn-download" onclick="downloadRecording('${url}', 'recording-${recordingCount}.webm')">
                    <i class="fas fa-download"></i> Download
                </button>
                <button class="btn-delete" onclick="this.parentElement.parentElement.remove()">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
        `;
        
        recordings.insertBefore(item, recordings.firstChild);
    }

    function playRecording(url) {
        const audio = new Audio(url);
        audio.play();
    }

    function downloadRecording(url, filename) {
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.click();
    }

    function updateTimer() {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const minutes = Math.floor(elapsed / 60);
        const seconds = elapsed % 60;
        document.getElementById('duration').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    }

    function visualize() {
        animationId = requestAnimationFrame(visualize);
        
        analyser.getByteTimeDomainData(dataArray);
        analyser.getByteFrequencyData(dataArray);

        // Calculate volume
        let sum = 0;
        for (let i = 0; i < bufferLength; i++) {
            sum += dataArray[i];
        }
        const average = sum / bufferLength;
        const volume = Math.round(average);
        const db = Math.round(20 * Math.log10(volume / 128));

        // Update volume meter
        const percentage = Math.min((volume / 255) * 100, 100);
        document.getElementById('volumeFill').style.width = percentage + '%';
        document.getElementById('volumeDb').textContent = db + ' dB';

        // Update stats
        volumeReadings.push(db);
        if (db > peakVol) {
            peakVol = db;
            document.getElementById('peakVolume').textContent = peakVol;
        }
        
        const avgSum = volumeReadings.reduce((a, b) => a + b, 0);
        avgVol = Math.round(avgSum / volumeReadings.length);
        document.getElementById('avgVolume').textContent = avgVol;

        // Draw waveform
        drawWaveform();
        drawFrequency();
    }

    function drawWaveform() {
        const canvas = document.getElementById('waveformCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;

        analyser.getByteTimeDomainData(dataArray);

        ctx.fillStyle = 'rgba(15, 23, 42, 0.5)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.lineWidth = 2;
        ctx.strokeStyle = '#22d3ee';
        ctx.beginPath();

        const sliceWidth = canvas.width / bufferLength;
        let x = 0;

        for (let i = 0; i < bufferLength; i++) {
            const v = dataArray[i] / 128.0;
            const y = v * canvas.height / 2;

            if (i === 0) {
                ctx.moveTo(x, y);
            } else {
                ctx.lineTo(x, y);
            }

            x += sliceWidth;
        }

        ctx.lineTo(canvas.width, canvas.height / 2);
        ctx.stroke();
    }

    function drawFrequency() {
        const canvas = document.getElementById('frequencyCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;

        analyser.getByteFrequencyData(dataArray);

        ctx.fillStyle = 'rgba(15, 23, 42, 0.5)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        const barWidth = (canvas.width / bufferLength) * 2.5;
        let x = 0;

        for (let i = 0; i < bufferLength; i++) {
            const barHeight = (dataArray[i] / 255) * canvas.height;

            const r = barHeight + (25 * (i / bufferLength));
            const g = 250 * (i / bufferLength);
            const b = 50;

            ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;
            ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);

            x += barWidth + 1;
        }
    }

    // Mic selection change
    document.getElementById('micSelect').addEventListener('change', () => {
        if (audioContext) {
            stopTest();
        }
    });

    // Mobile menu toggle
    const hamburger = document.getElementById('hamburger');
    const navbar = document.getElementById('navbar');

    if (hamburger) {
        hamburger.addEventListener('click', function() {
            hamburger.classList.toggle('active');
            navbar.classList.toggle('active');
        });
    }
</script>

</body>
</html>